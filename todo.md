# 知乎文章爬取PDF生成器 - 开发任务清单

## 版本规划

### v0.1.0 - MVP基础版本 ✅
- [x] 项目结构搭建
- [x] 基础依赖安装
- [x] 知乎文章内容爬取（文本+图片）
- [x] Cookie认证实现
- [x] 简单的HTML模板生成
- [x] 基础PDF生成功能

### v0.2.0 - 样式优化版本 ✅
- [x] 知乎风格CSS样式（基础样式已集成，后续可微调）
- [x] 图片本地化处理
- [x] 反爬虫机制优化（已实现基本防护，后续可增强）
- [x] 异常处理完善
- [x] 命令行参数支持
- [x] **图文顺序优化** - 保持知乎原文的图文混排顺序

### v0.3.0 - GUI版本 ✅
- [x] GUI界面开发
  - [x] 文章链接输入框
  - [x] Cookie文件选择器
  - [x] 下载进度显示
  - [x] 状态反馈
- [x] 临时文件清理
  - [x] 下载完成后自动删除临时数据
  - [x] 只保留最终PDF文件
- [x] 用户体验优化
  - [x] 错误提示
  - [x] 成功提示
  - [x] 进度条
- [x] **界面优化**
  - [x] 支持窗口拖拽调整大小
  - [x] 增大默认窗口尺寸
  - [x] 简化解析记录显示（只显示文件名）
  - [x] 右键菜单添加"在文件夹中显示"功能
  - [x] Cookie和保存目录路径记忆功能
- [x] **时间显示优化**
  - [x] 时间戳格式优化（只保留日期）
  - [x] 避免Windows文件名非法字符
- [x] **内存优化**
  - [x] 图片直接下载到内存（base64）
  - [x] 无需本地图片文件
  - [x] 全程内存处理，更高效
- [x] **应用程序打包**
  - [x] PyInstaller打包
  - [x] 自定义图标设计
  - [x] 单文件exe发布

### v1.0.0 - 生产版本
- [ ] 完整的错误处理
- [ ] 性能优化
- [ ] 文档完善
- [ ] 测试用例
- [ ] 打包发布

## 当前开发任务 (v1.0.0 - 生产版本)

### 1. 生产环境优化
- [ ] 完整的错误处理和日志记录
- [ ] 性能优化和内存管理
- [ ] 兼容性测试（不同Windows版本）
- [ ] 用户体验测试

### 2. 文档和发布
- [ ] 完善用户使用说明
- [ ] 创建安装包
- [ ] 版本管理和更新机制

## 开发优先级
1. ✅ 基础爬取功能
2. ✅ Cookie认证
3. ✅ 内容提取
4. ✅ PDF生成
5. ✅ 样式优化
6. ✅ **图文顺序优化** (重要修复)
7. ✅ **GUI界面开发** (完成)
8. ✅ **用户体验优化** (完成)
9. ✅ **应用程序打包** (完成)
10. 生产版本优化

## 测试计划
- [x] 单篇文章爬取测试
- [x] 不同文章类型测试
- [x] 图片处理测试
- [x] PDF生成质量测试
- [x] 富文本热门词排版测试
- [x] **图文顺序测试** - 验证PDF中的图文顺序与知乎原文一致
- [x] GUI功能测试
- [x] 临时文件清理测试
- [x] 应用程序打包测试
- [ ] 生产环境测试

## 技术改进记录

### 图文顺序优化 (v0.2.0) ✅
**问题**: PDF中的图文顺序与知乎原文不一致，图片位置错乱

**解决方案**:
1. **scraper.py**: 修改`process_content`方法，递归遍历所有子节点
2. **pdf_generator.py**: 使用BeautifulSoup解析HTML，递归遍历节点保持顺序
3. **utils.py**: 改进`flatten_rich_text`函数，保持HTML结构和图片标签

**关键改进**:
- 按知乎原文的节点顺序处理内容
- 图片在HTML中保持原有位置
- 支持段落内图片、列表内图片等复杂场景
- 使用原始URL作为图片匹配key，确保准确性
- 只处理有效图片（http/https开头），忽略svg和无效图片

**测试**: 已通过实际知乎文章测试验证

### GUI开发 (v0.3.0) ✅
**目标**: 创建用户友好的GUI界面，简化使用流程

**功能需求**:
- 文章链接输入
- Cookie文件选择
- 一键下载PDF
- 进度显示
- 临时文件自动清理

**技术选型**: PyQt5 (功能丰富，界面美观)

**关键改进**:
- 支持窗口拖拽调整大小
- 增大默认窗口尺寸（600x500）
- 简化解析记录显示（只显示文件名）
- 右键菜单功能（打开PDF、在文件夹中显示、删除记录）
- Cookie和保存目录路径记忆功能
- 时间戳格式优化（只保留日期）

### 内存优化 (v0.3.0) ✅
**目标**: 提高处理效率，减少磁盘IO

**关键改进**:
- 图片直接下载到内存（base64格式）
- 无需本地图片文件存储
- 全程内存处理，更高效
- 自动清理所有临时文件

### 应用程序打包 (v0.3.0) ✅
**目标**: 创建可发布的单文件应用程序

**技术实现**:
- 使用PyInstaller打包
- 生成单文件exe
- 自定义图标设计（知乎蓝色PDF图标）
- 用户只需准备cookies.json文件

**发布文件**:
- 知乎PDF下载器.exe
- cookies.json (用户提供)
- 使用说明文档

## 项目状态
🎉 **v0.3.0 GUI版本已完成并打包发布！**

当前版本功能完整，用户体验良好，已可投入生产使用。