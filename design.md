# 知乎文章爬取PDF生成器 - 项目设计文档

## 项目概述
一个功能完整的知乎文章PDF下载工具，支持保持原文图文顺序，提供友好的GUI界面，可打包为单文件应用程序。

## 技术架构

### 核心技术栈
- **Python 3.8+** - 主要开发语言
- **PyQt5** - GUI界面框架
- **Selenium** - 处理动态加载内容
- **BeautifulSoup** - HTML解析
- **ReportLab** - PDF生成
- **Requests** - HTTP请求
- **PyInstaller** - 应用程序打包

### 系统架构
```
用户界面层 (GUI)
    ↓
业务逻辑层 (爬虫 + PDF生成)
    ↓
数据处理层 (内存处理 + 临时文件管理)
    ↓
网络层 (HTTP请求 + Cookie认证)
```

## 核心功能模块

### 1. 爬虫模块 (scraper.py)
**功能**: 知乎文章内容爬取和图片处理
- Cookie认证和会话管理
- 动态内容加载（Selenium）
- 图片下载到内存（base64）
- 富文本内容解析
- 图文顺序保持

**关键特性**:
- 递归遍历HTML节点，保持原文顺序
- 图片直接下载到内存，无需本地存储
- 支持复杂排版（段落内图片、列表内图片等）

### 2. PDF生成模块 (pdf_generator.py)
**功能**: 高质量PDF文档生成
- HTML内容解析和重构
- 图片格式转换和优化
- 中文字体支持
- 图文混排布局

**关键特性**:
- 使用BeautifulSoup解析HTML结构
- 按顺序分配图片，保持原文排版
- 自动图片格式转换（WebP → JPEG）
- 支持多种图片格式

### 3. GUI界面模块 (gui.py)
**功能**: 用户友好的图形界面
- 文章链接输入
- Cookie文件选择
- 下载进度显示
- 历史记录管理

**关键特性**:
- PyQt5现代化界面
- 配置记忆功能（Cookie路径、保存目录）
- 右键菜单操作（打开PDF、在文件夹中显示）
- 实时进度反馈

### 4. 工具模块 (utils.py)
**功能**: 通用工具函数
- 文件处理
- 时间戳生成
- Cookie加载
- 富文本处理

## 数据流程

### 1. 内容爬取流程
```
用户输入链接 → Selenium加载页面 → 解析HTML结构 → 提取文本和图片 → 下载图片到内存 → 生成结构化数据
```

### 2. PDF生成流程
```
结构化数据 → HTML重构 → 图片格式转换 → ReportLab生成PDF → 保存文件 → 清理临时数据
```

### 3. 用户交互流程
```
启动应用 → 加载配置 → 输入链接 → 选择Cookie → 开始下载 → 显示进度 → 完成提示 → 更新历史记录
```

## 技术实现要点

### 反爬虫处理
- 随机延时请求
- 模拟真实浏览器行为
- 设置合理的User-Agent
- Cookie认证机制

### 图片处理优化
- 内存中处理，减少磁盘IO
- 自动格式转换
- 图片质量优化
- 支持多种图片格式

### 图文顺序保持
- 递归遍历HTML节点
- 按原文顺序处理内容
- 图片位置精确定位
- 复杂排版场景支持

### 用户体验优化
- 配置自动记忆
- 进度实时显示
- 错误友好提示
- 历史记录管理

## 部署和发布

### 打包配置
- **打包工具**: PyInstaller
- **打包方式**: 单文件exe
- **图标设计**: 自定义知乎蓝色PDF图标
- **依赖管理**: 自动包含所有依赖

### 用户部署
- **运行环境**: Windows 10/11
- **依赖文件**: 仅需cookies.json
- **安装方式**: 无需安装，直接运行
- **配置存储**: 本地JSON文件

### 文件结构
```
发布包/
├── 知乎PDF下载器.exe    # 主程序
├── cookies.json         # 用户提供
└── 使用说明.txt         # 使用指南
```

## 性能优化

### 内存管理
- 图片直接下载到内存
- 及时清理临时数据
- 避免大文件本地存储
- 优化内存使用模式

### 处理效率
- 并发图片下载
- 智能缓存机制
- 格式转换优化
- 减少不必要的IO操作

## 安全考虑

### 数据安全
- Cookie信息本地存储
- 临时文件自动清理
- 敏感信息不记录日志
- 用户数据隐私保护

### 网络安全
- HTTPS请求验证
- 请求头伪装
- 异常重试机制
- 超时控制

## 扩展性设计

### 模块化架构
- 清晰的模块分离
- 标准化的接口设计
- 易于维护和扩展
- 插件化功能支持

### 配置管理
- JSON配置文件
- 用户偏好记忆
- 灵活的参数调整
- 版本兼容性

## 项目状态
🎉 **v0.3.0 版本已完成并发布**

### 已完成功能
- ✅ 完整的知乎文章爬取
- ✅ 图文顺序完美保持
- ✅ 友好的GUI界面
- ✅ 内存优化处理
- ✅ 应用程序打包
- ✅ 用户配置记忆

### 技术亮点
- 图文顺序100%还原
- 内存处理，高效快速
- 单文件发布，使用简单
- 配置记忆，用户体验佳

## 未来规划

### v1.0.0 生产版本
- 完整的错误处理和日志
- 性能进一步优化
- 兼容性测试完善
- 用户反馈收集

### 功能扩展
- 批量处理功能
- 更多平台支持
- 高级配置选项
- 云端同步功能